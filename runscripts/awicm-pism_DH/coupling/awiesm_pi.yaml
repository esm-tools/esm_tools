general:
    setup_name: "awiesm"
    compute_time: "01:20:00"
    initial_date: "2000-01-01"
    final_date: "2054-12-31"
    base_dir: "/work/ba0989/a270124/PalModII/experiments/"
    nmonth: 0
    nyear: 1
    exp_id: "pi_awiesm-pism"
    account: "ba0989"
    couple_dir: "${base_dir}/${exp_id}/couple/"
    #files_to_wait_for:
    #    - "${couple_dir}/latest_jsbach_init_file.nc"
    #    - "${couple_dir}/latest_gfw_atmo.nc"
    #    - "${couple_dir}/latest_veg_merged_file.nc"
    #clean_old_rundirs_keep_every: 5
    #clean_old_rundirs_except: 2

awiesm:
    version: "2.1"
    postprocessing: true
    #scenario: "PALEO"
    model_dir: "/pf/a/a270124/awiesm-2.1/"

echam:
    version: "6.3.05p2-concurrent_radiation-paleodyn"
    restart_unit: "years"
    echam2ice: True
    ice2echam: True
    nproca: 24 
    nprocb: 24 # this alone has no effect, nprocb still set to 24 in namelist.echam
    nprocar: 0 #switch off concurrent radiation, delete this line or switch to 24 to use concurrent radiation
    nprocbr: 0 #switch off concurrent radiation, delete this line or switch to 18 to use concurrent radiation
    npromar: 0
    lresume: 0
    disturbance: 1.000001
    ini_parent_dir: "/work/ba0989/a270124/PalModII/from_xiaoxu_pi/restarts/echam/"
    ini_parent_exp_id: "pi_final"
    ini_parent_date: "28351231"
    add_namelist_changes:
        namelist.echam:
            #dynctl:
            #    enstdif: 1.0
            parctl:
                nproca: 24 #this does the trick
                nprocb: 24 #this does the trick, nprocb is 18 in namelist.echam
                nprocar: 0 #switch off concurrent radiation, delete this line or switch to 24 to use concurrent radiation
                nprocbr: 0 #switch off concurrent radiation, delete this line or switch to 18 to use concurrent radiation
            #radctl:
            #    # NOTE(PG): From Peter KÃ¶hler:
            #    co2vmr: 275.938E-06
            #    ch4vmr: 640.417E-09
            #    n2ovmr: 263.084E-09
            #    # NOTE(PG): From the Berger program:
            #    cecc: 0.040013
            #    cobld: 23.798000
            #    clonp: 127.14
            #    lrad_async: False
            #    yr_perp: remove_from_namelist
            runctl:
                l_orbvsop87: false
                default_output: false
            wisoctl:
                lwiso_rerun: False
                lwiso: False
                nwiso: 0
    
    add_input_sources:
        gfw_atmo: "${couple_dir}/latest_gfw_atmo.nc"
    workflow:
            next_run_triggered_by: couple_out
            subjobs:
                couple_in:
                    nproc: 1
                    run_before: prepcompute
                    script: coupling_ice2echam.functions
                    script_dir: /pf/a/a270124/esm_tools/runscripts/awicm-pism/coupling/
                    call_function: ice2echam
                    env_preparation: env_echam.py
                    run_only: first_run_in_chunk
                    skip_chunk_number: 1

                couple_out:
                    nproc: 1
                    run_after: tidy
                    script: coupling_echam2ice.functions
                    script_dir: /pf/a/a270124/esm_tools/runscripts/awicm-pism/coupling/
                    call_function: echam2ice
                    env_preparation: env_echam.py
                    run_only: last_run_in_chunk

jsbach:
    add_input_sources:
        #jsbach_1850: "/work/ba1066/a270061/mesh_CORE2_finaltopo_mean/tarfilesT63/input/jsbach/jsbach_T63CORE2_11tiles_5layers_1850.nc"
        jsbach_1850: "${couple_dir}/latest_jsbach_init_file.nc"
    lresume: 0
    ini_parent_exp_id: "pi_final"
    ini_parent_date: "28351231"
    ini_parent_dir: "/work/ba0989/a270124/PalModII/from_xiaoxu_pi/restarts/jsbach/"

hdmodel:
    lresume: 0
    ini_parent_exp_id: "pi_final"
    ini_parent_date: "28351231"
    ini_parent_dir: "/work/ba0989/a270124/PalModII/from_xiaoxu_pi/restarts/hdmodel/"

oasis3mct:
    lresume: 0
    ini_parent_exp_id: "pi_final"
    ini_parent_date: "28351231"
    ini_parent_dir: "/work/ba0989/a270124/PalModII/from_xiaoxu_pi/restarts/oasis3mct/"

fesom:
    version: "2.0"
    res: "CORE2"
    pool_dir: "/pool/data/AWICM/FESOM2"
    mesh_dir: "/pf/a/a270064/bb1029/AWIESM2.1-EXP/mesh_core2/"
    namelist_dir: "/pf/a/a270064/bb1029/AWIESM2.1-EXP/work_RC12_wiso/"
    restart_rate: 1
    restart_unit: "y"
    restart_first: 1
    lresume: 1
    ini_parent_dir: "/pf/a/a270064/bb1029/awiesm_exp//pi_final/restart/fesom/"
    ini_parent_exp_id: "pi_final"
    ini_parent_date: "28351231"
    add_namelist_changes:
        namelist.config:
            paths:
                ClimateDataPath: "/pf/a/a270064/work/AWIESM2.1-EXP/hydrography/"
                ForcingDataPath: remove_from_namelist
                OpbndPath: remove_from_namelist
                TideForcingPath: remove_from_namelist
            run_config:
                lwiso: False
            geometry:
                force_rotation: true 

    workflow:
            next_run_triggered_by: couple_out
            subjobs:
                couple_in:
                    nproc: 1
                    run_before: prepcompute
                    script: coupling_ice2fesom.functions
                    script_dir: /pf/a/a270124/esm_tools/runscripts/awicm-pism/coupling/
                    call_function: ice2fesom
                    env_preparation: env_fesom.py
                    run_only: first_run_in_chunk
                    skip_chunk_number: 1

                couple_out:
                    nproc: 1
                    run_after: tidy
                    script: coupling_fesom2ice.functions
                    script_dir: /pf/a/a270124/esm_tools/runscripts/awicm-pism/coupling/
                    call_function: fesom2ice
                    env_preparation: env_fesom.py
                    run_only: last_run_in_chunk
