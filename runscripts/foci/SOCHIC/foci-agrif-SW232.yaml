#computer:
#  additional_flags: "--qos=preempt"
#
general:
   use_venv: False
   verbose: False
   setup_name: "foci"
   version: "agrif_oasismct4"
   homedir: !ENV ${HOME}

   compute_time: "01:00:00"
   #initial_date: "2049-01-06T00:00:00"       # Initial exp. date
   #final_date: "2049-02-01T00:00:00"         # Final date of the experiment
   #nday: 26
   #initial_date: "2049-04-01T00:00:00"       # Initial exp. date
   #final_date: "2050-01-01T00:00:00"         # Final date of the experiment
   #nmonth: 1 
   initial_date: "2050-01-01T00:00:00"       # Initial exp. date
   final_date: "2055-01-01T00:00:00"         # Final date of the experiment
   nmonth: 12 
   postprocessing: True
   clean_runs: 2 
   
   # machine specific setup 
   account: shk00057
   base_dir: ${homedir}/esm/esm-experiments/

   # TODO: BUG: settings are NOT used if ini_parent_exp_id and current expid are the same
   lresume: true
   #ini_parent_exp_id: "WG10_1day_300s"
   #ini_parent_date: "20490105"
   #ini_nemo_restart_steps: 1440
   #ini_parent_dir: "/scratch/usr/shkifmsw/esm-experiments/${ini_parent_exp_id}/restart/"
   #
   #ini_parent_exp_id: "WG10-SW232-2m-ts1200"
   #ini_parent_date: "20490331"
   #ini_nemo_restart_steps: 4248
   #ini_parent_dir: "/scratch/usr/shkifmsw/esm-experiments/${ini_parent_exp_id}/restart/"
   #
   ini_parent_exp_id: "WG10-SW232-1m-1200s"
   ini_parent_date: "20491231"
   ini_nemo_restart_steps: 19800 
   #ini_parent_dir: "/scratch/usr/shkifmsw/esm-experiments/${ini_parent_exp_id}/restart/"
   ini_parent_dir: "/scratch/usr/shkifmsw/foci_input2/FOCI_RESTART/${ini_parent_exp_id}/"
   #
   #ini_parent_exp_id: "WG10-SW232-9m-ts1200"
   #ini_parent_date: "20491231"
   # TODO: BUG: settings are NOT used if ini_parent_exp_id and current expid are the same
   #ini_nemo_restart_steps: 99000
   #ini_parent_dir: "/scratch/usr/shkifmsw/esm-experiments/${ini_parent_exp_id}/restart/"

computer:
   partition: "standard96:test"

foci:
   #model_dir: ${general.homedir}/esm/models/tmp/foci-agrif_oasismct4/
   model_dir: ${general.homedir}/esm/models/foci-agrif_oasismct4/

oasis3mct:
   input_dir: "/scratch/usr/shkifmsw/foci_input2/OASIS3_ECHAM6T63_ORCA05/input/T63_ORCA05_${nemo.nest1}/"
   coupling_time_step: 3600
   #export_mode: EXPOUT
   #export_mode_a2o: EXPOUT

echam:
   scenario: "1950"
   resolution: "T63"
   #restart_rate: ${general.nday}
   #restart_unit: "days"
   restart_rate: ${general.nmonth}
   restart_unit: "months"
   nproca: 16
   nprocb: 12
   namelist_changes:
     namelist.echam:
       runctl:
         nproma: 96
         putocean: [ 8, 'steps', 'exact', -450 ]
         getocean: [ 8, 'steps', 'exact', 0 ]
   
nemo:
   time_step: 1200
   nest1: WG10v4
   agrif_dir: /scratch/usr/shkifmsw/foci_input2/AGRIF/agrif_${nest1}
   resolution: "ORCA05"
   version: "ORCA05_LIM2_KCM_AGRIF_OASISMCT4" 
   jpni: 36 
   jpnj: 24
   nproc: 864
   # the brute-force approach to the hostfile_srun missing / empty file
   #pre_run_commands: "cp -f ~/FOCI2.2-SW230_hostfile ${work_dir}/hostfile_srun"
   #add_input_sources:
   #   manual_hostfile: ${general.homedir}/MO053_hostfile
   #add_input_files:
   #   manual_hostfile: manual_hostfile
   #add_input_in_work:
   #   manual_hostfile: hostfile_srun
   # jpni and jpnj are 0 by default, i.e. automatic distribution on CPUs
   #
   # if an initial run does not work, or if you experience instabilities in NEMO or the NEST
   # the following settings may help to get past those instabilities
   add_namelist_changes:
     namelist_cfg:
       # output initial state
       namrun:
         nn_istate: 1
       ## horizontal bilaplacian eddy viscosity [m4/s]
       ## number based on desired characteristic velocity (here, 12 cm/s)
       namdyn_ldf:
         rn_ahm_0_blp: -1.709e12
       # eddy diffusivity 
       namtra_ldf:
         #iso-neutral diffusion
         rn_aht_0: 605
         #switched back to 600 from 300 after 50 years
         # scaling of "eddy-induced" velocities in G&M scheme
         rn_aeiv_scale: 0.5
     namelist_top_cfg:
       # eddy diffusivity seen by tracers
       namtrc_ldf:
         rn_ahtrc_0: 600
         # Note! rn_ahtrc_0 should match rn_aht_0 above
     #namelist_ice_cfg:
       # ice thickness for lateral accretion in the Northern (Southern) Hemisphere
       #namicethd:
       #  hiccrit: [0.3, 1.0]
       # ice dynamic: 1st bulk-rheology parameter
       #namicedyn:
       #  pstar: 15000
     1_namelist_cfg:
       # output initial state
       namrun:
         nn_istate: 1
       ## horizontal bilaplacian eddy viscosity [m4/s]
       ## number based on desired characteristic velocity (here, 12 cm/s)
       namdyn_ldf:
         rn_ahm_0_blp: -1.37e10
       # eddy diffusivity in nest - set similar to ORCA12!
       namtra_ldf:
         rn_aht_0: 120
     1_namelist_top_cfg:
       # eddy diffusivity seen by tracers in nest
       namtrc_ldf:
         rn_ahtrc_0: 120
         # Note! rn_ahtrc_0 should match rn_aht_0 above
     #1_namelist_ice_cfg:
       # ice thickness for lateral accretion in the Northern (Southern) Hemisphere
       #namicethd:
       #  hiccrit: [0.3, 1.0]
       # ice dynamic: 1st bulk-rheology parameter
       #namicedyn:
       #  pstar: 15000
       #
   #choose_lresume:
   #   true:
   #      choose_general.run_number:
   #         1:
   #            global_tag: ""

xios:
   nproc: 36
   #xml_dir: /home/shkifmsw/esm/models/tmp/foci-agrif_oasismct4/nemo-ORCA05_LIM2_KCM_AGRIF_OASISMCT4/CONFIG/ORCA05_LIM2_KCM_AGRIF_OASISMCT4/EXP00
