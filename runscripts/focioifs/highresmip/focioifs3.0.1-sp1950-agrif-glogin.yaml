# example to use the a small number of nodes / CPUs that 
general:
   use_venv: False
   verbose: False 
   homedir: !ENV ${HOME}
   
   setup_name: "focioifs"      
   version: "agrif-3.0"
   resolution: "TCO95_ORCA05"

   compute_time: "04:00:00"
   initial_date: "1950-01-01T00:00:00"       # Initial exp. date
   final_date: "2050-01-01T00:00:00"         # Final date of the experiment

   nyear: 1
   nmonth: 0
   nday: 0
   restart_rate: 1
   restart_unit: days 
   hours: 0
  
   # machine specific setup 
   account: shk00018 
   base_dir: ${general.homedir}/esm/esm-experiments/ 
   
   postprocessing: 1
   
computer: 
   partition: "standard96" 

focioifs:
   model_dir: ${general.homedir}/esm/models/focioifs-agrif-3.0/
   #version: "agrif-3.0"
  
oifs:
   #runtime_environment_changes:
   #   choose_computer.name:
   #      "glogin":
   #          compiler_mpi: intel2019_impi2019

   version: "43r3"
   with_xios: True
   scenario: "historical"
   mip: "cmip6"
   input_dir: "${pool_dir}/OPENIFS43R3-TCO95/"
   rtables_dir: "${pool_dir}/OPENIFS_CY43_GENERAL/rtables/"
   vtables_dir: "${pool_dir}/OPENIFS_CY43_GENERAL/vtables/"
   clim_dir: "${pool_dir}/OPENIFS43R3-TCO95/95_4/"
   ifsdata_dir: "/scratch/projects/shk00018/foci_input2/openifs_cy43_general/ifsdata/"
   cmip5_data_dir: "${pool_dir}/OPENIFS_CY43_GENERAL/cmip5_ghg/"
   cmip6_data_dir: "${pool_dir}/OPENIFS_CY43_GENERAL/cmip6-data/"
   icmcl_dir: "${pool_dir}/OPENIFS43R3-TCO95/2008010100/"
   icmcl_file: "ICMCLhagwINIT"
   prepifs_expid: hagw
   prepifs_startdate: 20080101
   resolution: TCO95
   levels: L91
   time_step: 1800
   lresume: 0
   nproc: 144
   omp_num_threads: 2
   use_ocean_currents: 1
   
   # use CMIP6 ozone
   o3_scheme: cmip6
   
   # new solar spectrum
   solarspectrum: True
   
   with_nest1: true
   add_namelist_changes:
      fort.4:
         NAERAD:
              NAERANT_SCALE: 1 # turn on aerosol scaling
              NCMIPFIXYR: 1950 # Fix GHG to 1950
              LSOLAR1950: ".true." # solar cycle for 1950 as HrMIP
         NAMCLDP:
              # diffusion coeff for cloud edges
              RCLDIFF: 5.e-6 # default 3e-6
              # for convection, RCLDIFF=RCLDIFF*RCLDIFF_CONVI
              #RCLDIFF_CONVI: 7 # default 7.0
         NAMMCC:
              RALBSEAD_NML: 0.045
              RALBSCALE_AR: 0.8

oasis3mct:
   #o2a_remap_method: "conserv"
   #a2o_remap_method: "conserv"
   #agr2a_remap_method: "conserv" 
   c2o_remap_method: "gauswgt" 
   coupling_time_step: 3600 
   mct_version: "5.0" 
   norestart: F
   use_lucia: True
   debug_level: 1 
   #export_mode: EXPOUT
   pool_dir: /scratch/projects/shk00018/foci_input2/oasis3_openifs43r3-tco95_orca05_viking10/
   ini_parent_dir: /scratch/projects/shk00018/foci_input2/oasis3_openifs43r3-tco95_orca05_viking10/
   oasis_date_stamp: ""
      
nemo:
   # Note for future runs:
   # We currently use a 5x grid refinement in VIKING10 and 3x time step
   # It would make more sense to also refine time step by 5x so that Courant number is reasonable
   # This can be done by simply changing the 3 to a 5 in the 2nd line of AGRIF_FixedGrids.in 
   # So far, we stick with 3x to keep consistency with existing runs. 
   agrif_dir: /scratch/projects/shk00018/foci_input2/agrif_viking10_jk/
   resolution: "ORCA05"
   #time_step: 600      
   version: "ORCA05_LIM2_KCM_AGRIF_OASISMCT4"
   # This gives subdomains of 15x15 grid cells which is near the limit in NEMO
   # More nproc should not be used
   jpni: 48
   jpnj: 36
   nproc: 1728
   nest1: viking10
   
   add_namelist_changes:
      namelist_cfg:
         # It may be necessary to set fsbc=1 to avoid 
         # breaking CFL for LIM2
         #namsbc: 
         #   nn_fsbc: 1
         namsbc_rnf:
            rn_rfact: 1.00
         # Malins visc and diff changes
         namldf_dyn:
            rn_ahm_0_blp: -1.709e12
         namldf_tra:
            rn_aht_0: 600
      1_namelist_cfg:
         #namsbc:
         #   nn_fsbc: 1
         namlbc:
            rn_shlat: 0
         namsbc_rnf:
            rn_rfact: 1.0
         # Computed as -1.709e12 / 5^3 
         # Note: -1.709e12 is applied at the largest ORCA05 cell, at equator
         # but coeff is actually -1.267e12 where VIKING10 starts
         # So ahm should be -1.267e12 / 5^3 = -1.013e10
         # We should scale this by 0.74. 
         namldf_dyn:
            rn_ahm_0_blp: -1.37e10
         # Computed as 600 / 5
         # Similarly as above, this should be 89 
         namldf_tra:
            rn_aht_0: 120
   
rnfmap:
   nproc: 1

xios: 
   with_model: focioifs 
   xml_dir: /scratch/projects/shk00018/foci_input2/oasis3_openifs43r3-tco95_orca05_viking10/output_for_prod/
   # This should make 4 XIOS cores spread over 2 nodes (on HLRN standard96(
   nproc: 4
   omp_num_threads: 48 
